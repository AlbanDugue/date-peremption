{% extends 'base.html.twig' %}

{% block title %}Frigo {{ parent() }}{% endblock %}

{% block main %}

     {# Container global de la page #}
    <div id="container-liste">

        {# Condition si il n'y a pas d'aliments li√©s √† un utilisateur #}
        {% if not aliments %}
            {# Alors on affiche une div informative pour dire d'ajouter un aliment #}
            <div id="pas-aliments">
                <h2>ü•ë üçï üçÑ üßÉ ü•ù üç∞</h2>
                <h2> Aucuns aliments üòÅ</h2>
                <p>Ajoutes des aliments avec le bouton</p>
                <h2>üßÉ ü•ù üç∞ ü•ë üçï üçÑ</h2>
            </div>
        {% endif %}

        {# Boucle pour chaque aliment r√©cup√©rer par utilisateur #}
        {% for aliment in aliments %}
            {# affichage de donn√©es concernant un aliment avec une action li√©e #}
            <article>
                {# Bloc li√© √† sa date de p√©remption au format jour/mois/ann√©e de la plus ancienne √† la plus r√©cente #}
                <div>
                    <p class="date-peremption">{{ aliment.datePeremption|date('d/m/y') }}</p>
                </div>

                {# Bloc li√© au nom de l'aliment  #}
                <div>
                    {# Condition si l'aliment est p√©rim√© depuis plus de 3 jours alors il est barr√© #}
                    <p class="nom-aliment" {% if aliment.datePeremption < date('now -3 day') %}
                                                style="text-decoration: line-through"
                                            {% endif %}>
                        {# Affichage du nom de l'aliment #}
                        {{ aliment.nom }}
                        {# Condition si l'aliment est p√©rim√© depuis moins de 3 jours  #}
                        {% if aliment.datePeremption < date('now') and aliment.datePeremption > date('now -3 day') %}
                            {# Affichage d'un emoji flamme coll√© au nom de l'aliment #}
                            üî•
                        {% endif %}
                        {# Condition si l'aliment est p√©rim√© dans 2 jours ou moins  #}
                        {% if aliment.datePeremption < date('now + 2 day') and aliment.datePeremption > date('now') %}
                            {# Affichage d'un emoji sablier coll√© au nom de l'aliment #}
                            ‚è≥
                        {% endif %}
                    </p>
                </div>

                {# Bloc li√© √† l'action de supprim√© l'aliment  #}
                <div>
                    {# Appel de la fonction supprim√© aliment dans le MainController en passant son id en param√®tre #}
                    <button class="bouton-suppr"><a href="{{ path('delete', {'id': aliment.id}) }}">&times;</a></button>
                </div>
            </article>
        {% endfor %}

        {# Trigger qui ouvre la modal (voir javascript ci-dessous) #}
        <div id="bloc-ajout">
            <button id="bouton-ajout"><a href="#">+</a></button>
        </div>

        {# Modal global #}
        <div id="myModal" class="modal">

            {# Contenu dans la modal #}
            <div class="modal-content">

                {# Div pour fermer la modale #}
                <div class="close"><p>&times;</p></div>

                {# D√©but du formualaire d'ajout d'aliment #}
                {{ form_start (alimentForm) }}
                <div id="formAjoutAliment">
                {{ form_row(alimentForm.nom) }}

                {{ form_row(alimentForm.datePeremption) }}

                {{ form_widget(alimentForm) }}

                    {# Bouton submit pour ajouter un aliment en base et revenir sur la page home #}
                    <button id="validation-ajout" type="submit">Ajouter</button>
                </div>

                {{ form_end (alimentForm) }}
            </div>
        </div>
    </div>
{% endblock %}

{% block javascripts %}
    <script>
        // Get the modal
        var modal = document.getElementById("myModal");

        // Get the button that opens the modal
        var btn = document.getElementById("bouton-ajout");

        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];

        var menuHeader = document.getElementById("menu-header");

        // When the user clicks the button, open the modal
        btn.onclick = function() {
            modal.style.display = "block";
            menuHeader.style.display = "none";
        }

        // When the user clicks on <span> (x), close the modal
        span.onclick = function() {
            modal.style.display = "none";
            menuHeader.style.display = "flex";
        }

        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
            if (event.target == modal) {
                modal.style.display = "none";
            }
        }
    </script>
{% endblock %}
